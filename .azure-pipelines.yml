# Trigger is set to run on changes to the main branch
trigger:
  - main  # This will trigger the pipeline when changes are pushed to the main branch

# Define the agent pool and demands for the job
pool:
  name: Default  # Use the agent pool named "Default"
  demands:  # Ensure it runs only on the agent named "automation-9999"
    - agent.name -equals automation-9999

# Stages for the pipeline
stages:
  # Stage for Terraform operations
  - stage: Terraform_BPG_Provider_Clone_VM  # This stage is for the Terraform BPG Provider Clone VM
    displayName: "Terraform - BPG Provider Clone VM" # Display name for the stage in Azure DevOps UI
    jobs: # Define the jobs within this stage
      - template: Azure_DevOps_Pipelines/terraform.yml  # Use the terraform.yml template for the job
        parameters:  # Parameters for the terraform job
          tfRoot: 'Terraform/bpg_terraform-clone-vm'  # e.g. 'Terraform/bpg_terraform-clone-vm' - the root directory for Terraform files
          tfVarsFile: 'secrets.auto.tfvars'           # e.g. secrets.auto.tfvars - file (as secure file) from Azure DevOps --> Pipelines --> Library --> Secure Files
          sshKeyFile: 'id_rsa_pem'                    # e.g. id_rsa_pem - file (as secure file) from Azure DevOps --> Pipelines --> Library --> Secure Files
          varGroup: 'Private_Variables'  # From Azure DevOps --> Pipelines --> Library --> Variable Group = 'Private_Variables'