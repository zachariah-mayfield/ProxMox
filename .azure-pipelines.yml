trigger:
  - main

pool:
  name: Default      # Your agent pool name
  demands:
    - agent.name -equals automation-9999  # Your agent's name (optional)

variables:
  TF_ROOT: './Terraform'   # Path to your Terraform code folder

stages:
  - stage: Terraform
    jobs:
      - job: terraform_plan_apply
        steps:
          - script: |
              echo "Initializing Terraform"
              terraform -chdir=$(TF_ROOT) init
            displayName: 'Terraform Init'

          - script: |
              echo "Planning Terraform changes"
              terraform -chdir=$(TF_ROOT) plan
            displayName: 'Terraform Plan'

          - script: |
              echo "Applying Terraform changes"
              terraform -chdir=$(TF_ROOT) apply -auto-approve
            displayName: 'Terraform Apply'
